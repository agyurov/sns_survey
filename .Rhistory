# perform CLM if ordinal
if(!is.numeric(df$Y)){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df),test="Chisq",trace = 0))
if(exclude.warnings & z){
clms[i] = NULL
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
clms = clms[!sapply(clms,is.null)]
names(clms) = names(resp)
retu
model.list = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df),test="Chisq",trace = 0))
if(exclude.warnings & z){
clms[i] = NULL
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
clms = clms[!sapply(clms,is.null)]
names(clms) = names(resp)
return(clms)
}
fk = model.list(pred,resp,exclude.warnings = T)
T & T
T & F
F & F
model.list = function(pred,resp, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
clms[[i]] = step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
names(clms) = names(resp)
return(clms)
}
fk = model.list(pred,resp)
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df),test="Chisq",trace = 0))
if(exclude.warnings & z){
clms[i] = NULL
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
clms = clms[!sapply(clms,is.null)]
names(clms) = names(resp)
return(clms)
}
fk = model.listZ(pred,resp)
clms = list()
clms[[1:2]] = 1:2
clms[[1]] = 1:2
clms[[2]] = "bad"
clms[[3]] = "aaa"
clms
clms[clms!="bad"]
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df),test="Chisq",trace = 0))
if(exclude.warnings & z){
clms[i] = "bad"
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
names(clms) = names(resp)
clms = clms[clms!="bad"]
return(clms)
}
fk = model.listZ(pred,resp,exclude.warnings = F)
length(fk)
fk = model.listZ(pred,resp,exclude.warnings = T)
length(fk)
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df),test="Chisq",trace = 0))
if(z){
clms[i] = "bad"
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df),test="Chisq",trace = 0)
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
names(clms) = names(resp)
clms = clms[clms!="bad"]
return(clms)
}
fk = model.listZ(pred,resp,exclude.warnings = F)
fk = model.listZ(pred,resp,exclude.warnings = T)
m8
m7
# Predict pred with resp, w/o overlapping. trims NAs. Wrapper of model.list
model.list.adv = function(pred,resp,...){
newdf = na.omit(cbind(pred,resp))
print(paste0("Dim new dat = ",paste0(dim(newdf),collapse=" ")))
fk = model.listZ(pred = newdf[,!grepl(deparse(substitute(resp)),names(newdf))],
resp = newdf[,grepl(deparse(substitute(resp)),names(newdf))],...)
return(model.list = fk)
}
m7 = model.list.adv(pred = demo.dat, resp = q19, exclude.warnings = F)
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = F)
lapply(m6,summary)
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T)
lapply(m6,summary)
?clm
fk = model.listZ(resp = wine$rating, pred = wine$temp)
fk = model.listZ(resp = wine$rating, pred = wine$temp^3)
fk = model.listZ(resp = wine$rating, pred = wine$temp^2)
str(wine)
fk = model.listZ(resp = wine$rating, pred = wine$temp)
names(wine)
fk = model.listZ(resp = wine$rating, pred = wine[,c(1,3,4,5,6)])
fk
fk = model.listZ(resp = wine$rating, pred = wine[,c(1,3,4,5,6)],exclude.warnings=T)
fk
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = F)
m6$q18.1_lifesat1
m6$q18.1_lifesat1$message
m6$q18.2_lifesat2
m6$q18.3_lifesat3
m6$q18.3_lifesat4
m6$q18.4_lifesat4
m6$q18.5_lifesat5
m6$q18.5_lifesat5$convergence
lapply(m6,function(x) x$convergence$code)
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T)
lapply(m6,summary)
?cat
pred = pred1q7q8
resp = resp1q7q8
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0))
if(z){
clms[i] = "bad"
cat(paste0("CLM convergence code 1 for i = ",i,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0))
if(z){
clms[i] = "bad"
cat(paste0("CLM convergence code 1 for i = ",i,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
names(clms) = names(resp)
clms = clms[clms!="bad"]
return(clms)
}
fk = model.listZ(pred,resp)
length(fk)
lapply(fk,class)
fk = model.listZ(pred,resp,exclude.warnings = T)
lapply(fk,class)
m8 = model.list.adv(pred = demo.dat, resp = q20)
m8 = model.list.adv(pred = demo.dat, resp = q20, exclude.warnings = T)
m8
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0))
if(z){
clms[i] = "bad"
cat(paste0("CLM convergence code 1 for i = ",i,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
# names(clms) = names(resp)
# clms = clms[clms!="bad"]
return(clms)
}
m8 = model.list.adv(pred = demo.dat, resp = q20, exclude.warnings = T)
m8
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0))
if(z){
clms[i] = "bad"
cat(paste0("CLM convergence code 1 for i = ",i,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
}
names(clms) = names(resp)
# clms = clms[clms!="bad"]
return(clms)
}
m7 = model.list.adv(pred = demo.dat, resp = q19, exclude.warnings = F)
m7 = model.list.adv(pred = demo.dat, resp = q19, exclude.warnings = T)
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0))
if(z){
clms[i] = "bad"
cat(paste0("CLM convergence code 1 for i = ",i,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
}
names(clms) = names(resp)
# clms = clms[clms!="bad"]
return(clms)
}
m1 = model.list.adv(pred = demo.dat, resp = q11, exclude.warnings = T)
m2 = model.list.adv(pred = demo.dat, resp = q12, exclude.warnings = T)
m3 = model.list.adv(pred = demo.dat, resp = q13, exclude.warnings = T)
q19nonanum
plot.matrix(cor(q19nonanum))
round(cor(q19nonanum),3)
record()
m2 = model.list.adv(pred = demo.dat, resp = q12, exclude.warnings = T)
(m3 = model.list.adv(pred = demo.dat, resp = q13, exclude.warnings = T))
(m4 = model.list.adv(pred = demo.dat, resp = q15, exclude.warnings = T))
(m5 = model.list.adv(pred = demo.dat, resp = q16, exclude.warnings = T))
?clm
# model.list + warnings parameter
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
z <- has_warning(clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0))
if(z){
# clms[i] = "bad"
cat(paste0("CLM convergence code for i = ",i," is ", clms[[i]]$convergence$code,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
}
names(clms) = names(resp)
# clms = clms[clms!="bad"]
return(clms)
}
rm(m1)
rm(m2)
rm(m3)
(m1 = model.list.adv(pred = demo.dat, resp = q11, exclude.warnings = T))
(m2 = model.list.adv(pred = demo.dat, resp = q12, exclude.warnings = T))
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
if(clms[[i]]$convergence$code != 0){
clms[i] = "bad"
cat(paste0("CLM convergence code for i = ",i," is ", clms[[i]]$convergence$code,"...\n"))
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
}
names(clms) = names(resp)
# clms = clms[clms!="bad"]
return(clms)
}
(m2 = model.list.adv(pred = demo.dat, resp = q12, exclude.warnings = T))
model.list + warnings parameter
model.listZ = function(pred,resp,exclude.warnings=F, ...){
# x predictors
# y responses
clms = list()
pred = as.data.frame(pred)
resp = as.data.frame(resp)
for(i in 1:ncol(resp)){
cat(paste0("Estimating model ",i," of ", ncol(resp),"\n"))
df = cbind(pred,Y=resp[,i])
frmla = as.formula(paste0("Y"," ~ ",paste0(names(pred),collapse=" + ")))
# perform LM if numeric
if(is.numeric(df$Y)){
clms[[i]] = step(lm(formula=frmla,data=df,...),test="F",trace = 0)
}
# perform CLM if ordinal
if(!is.numeric(df$Y)){
if(exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
if(clms[[i]]$convergence$code != 0){
cat(paste0("CLM convergence code for i = ",i," is ", clms[[i]]$convergence$code,"...\n"))
clms[i] = "bad"
}
}
if(!exclude.warnings){
clms[[i]] <- step(clm(formula=frmla,data=df,...),test="Chisq",trace = 0)
}
}
}
names(clms) = names(resp)
clms = clms[clms!="bad"]
return(clms)
}
(m1 = model.list.adv(pred = demo.dat, resp = q11, exclude.warnings = T))
m2 = model.list.adv(pred = demo.dat, resp = q12, exclude.warnings = T)
m2$q12.1_lookupclassmate
m2$q12.2_lookupfriends
m3 = model.list.adv(pred = demo.dat, resp = q13, exclude.warnings = T)
m4 = model.list.adv(pred = demo.dat, resp = q15, exclude.warnings = T)
m4$q15.2_distfriends
lapply(m4,summary)
lapply(m4,eval.model)
plot.clm(m4)
m5 = model.list.adv(pred = demo.dat, resp = q16, exclude.warnings = T)
lapply(m5,summary)
lapply(m5,eval.model)
plot.clm(m5)
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T)
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T, link = "cauchit")
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T, link = "probit")
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T, link = "cloglog")
lapply(m6,summary)
m6 = model.list.adv(pred = demo.dat, resp = q18, exclude.warnings = T, link = "logit")
m7 = model.list.adv(pred = demo.dat, resp = q19, exclude.warnings = T)
m7 = model.list.adv(pred = demo.dat, resp = q19, exclude.warnings = T, link = "cauchit")
m7 = model.list.adv(pred = demo.dat, resp = q19, exclude.warnings = T, link = "cloglog")
m8 = model.list.adv(pred = demo.dat, resp = q20, exclude.warnings = T)
lapply(m8,summary)
